<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선생님과 학생을 위한 Big 5 강점 코칭 AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .bg-gradient-custom {
            background-color: #f0f4ff;
            background-image: linear-gradient(135deg, #f0f4ff 0%, #e6e9ff 100%);
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            margin-top: -6px;
            background-color: #4f46e5; /* indigo-600 */
            height: 24px;
            width: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #c7d2fe;
        }
        input[type=range]::-moz-range-thumb {
            background-color: #4f46e5;
            height: 24px;
            width: 24px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid white;
            box-shadow: 0 0 0 2px #c7d2fe;
        }
        .result-card, #ai-result-card {
            transition: all 0.6s cubic-bezier(0.25, 0.8, 0.25, 1);
            transform: translateY(30px);
            opacity: 0;
        }
        .result-card.visible, #ai-result-card.visible {
            transform: translateY(0);
            opacity: 1;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        .role-selector input:checked + label {
            background-color: #4f46e5;
            color: white;
            border-color: #4f46e5;
            box-shadow: 0 4px 14px 0 rgba(79, 70, 229, 0.3);
        }
    </style>
</head>
<body class="bg-gradient-custom text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-7xl">
        <header class="text-center mb-10">
            <h1 class="text-3xl md:text-4xl font-bold text-indigo-900 flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-10 h-10 mr-3 text-indigo-500"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>
                Big 5 강점 발견 및 성장 코칭 AI
            </h1>
            <p class="mt-3 text-lg text-indigo-700">나의 성격 강점이 어떻게 빛날 수 있을까요? AI가 당신의 성장을 응원합니다.</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Main Content -->
            <main class="lg:col-span-2 bg-white/70 backdrop-blur-sm p-6 md:p-8 rounded-2xl shadow-lg border border-gray-200/50">
                <div id="input-section">
                    <div class="mb-8">
                        <h2 class="text-2xl font-bold mb-4 text-center text-gray-800">1. 당신의 역할을 선택해주세요</h2>
                        <div class="flex justify-center gap-4 role-selector">
                            <input type="radio" id="role-teacher" name="role" value="teacher" class="hidden" checked>
                            <label for="role-teacher" class="cursor-pointer text-center font-bold py-3 px-8 rounded-full border-2 border-gray-300 transition-all duration-300 hover:border-indigo-400">선생님</label>
                            
                            <input type="radio" id="role-student" name="role" value="student" class="hidden">
                            <label for="role-student" class="cursor-pointer text-center font-bold py-3 px-8 rounded-full border-2 border-gray-300 transition-all duration-300 hover:border-indigo-400">학생</label>
                        </div>
                    </div>
                    
                    <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">2. 나의 Big 5 점수 입력하기</h2>
                    <div class="space-y-6">
                        <div id="trait-sliders"></div>
                    </div>
                    <div class="text-center mt-8">
                        <button id="analyze-btn" class="bg-indigo-600 text-white font-bold py-3 px-8 rounded-full hover:bg-indigo-700 transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:scale-105">
                            결과 분석하기
                        </button>
                    </div>
                </div>

                <div id="result-section" class="hidden mt-10">
                    <h2 id="result-title" class="text-2xl font-bold mb-6 text-center"></h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-center">
                        <div class="w-full h-full flex justify-center items-center p-4">
                            <canvas id="result-chart"></canvas>
                        </div>
                        <div id="keyword-section" class="flex flex-wrap gap-3 justify-center items-center"></div>
                    </div>
                    <div id="interpretation-section" class="mt-10 space-y-6"></div>
                    
                    <div id="ai-section" class="hidden text-center mt-12">
                        <button id="ai-btn" class="bg-teal-500 text-white font-bold py-3 px-8 rounded-full hover:bg-teal-600 transition-all duration-300 text-lg shadow-lg hover:shadow-xl transform hover:scale-105 flex items-center justify-center mx-auto">
                        </button>
                        <div id="ai-result-card" class="hidden mt-6 bg-teal-50/70 backdrop-blur-sm p-6 rounded-xl shadow-md text-left border border-teal-200/50">
                            <div id="ai-loading" class="flex justify-center items-center">
                                <div class="loader"></div>
                                <p id="ai-loading-text" class="ml-4 text-teal-700 font-semibold"></p>
                            </div>
                            <div id="ai-content" class="hidden">
                                <h3 id="ai-title" class="text-xl font-bold text-teal-800 mb-3 flex items-center"></h3>
                                <p id="ai-tip" class="text-gray-700 whitespace-pre-wrap"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>

            <!-- API Key Sidebar -->
            <aside class="lg:col-span-1">
                <div class="bg-white/70 backdrop-blur-sm p-6 rounded-2xl shadow-lg sticky top-8 border border-gray-200/50">
                    <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2 text-gray-600"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 0 2l-.15.08a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1 0-2l.15-.08a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                        AI 연동 설정
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <label for="apiKeyInput" class="block mb-2 text-sm font-medium text-gray-700">Gemini API 키</label>
                            <input type="password" id="apiKeyInput" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-indigo-500 focus:border-indigo-500 block w-full p-2.5" placeholder="API 키를 여기에 입력하세요">
                            <p id="api-key-error" class="text-red-500 text-xs mt-1 h-4"></p>
                        </div>
                        <p class="text-xs text-gray-500">
                            AI 코칭 기능을 사용하려면 Google AI Studio에서 발급받은 API 키가 필요합니다. 
                            키는 브라우저에만 저장되며, 서버에는 전송되지 않습니다.
                        </p>
                        <button id="save-key-btn" class="w-full bg-gray-600 text-white font-bold py-2 px-4 rounded-full hover:bg-gray-700 transition-colors duration-300 text-sm">
                            API 키 저장
                        </button>
                    </div>
                </div>
            </aside>
        </div>

        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>&copy; 2025 Created by SHINY_PEACE. All rights reserved.</p>
        </footer>
    </div>

    <script>
        // --- DATA ---
        const traits = {
            O: { name: "경험에 대한 개방성 (Openness)", color: "rgba(239, 68, 68, 0.6)" },
            C: { name: "성실성 (Conscientiousness)", color: "rgba(59, 130, 246, 0.6)" },
            E: { name: "외향성 (Extraversion)", color: "rgba(245, 158, 11, 0.6)" },
            A: { name: "친화성 (Agreeableness)", color: "rgba(16, 185, 129, 0.6)" },
            N: { name: "신경성 (Neuroticism)", color: "rgba(139, 92, 246, 0.6)" }
        };
        
        const teacherInterpretations = {
            O: {
                high: { title: "창의적인 수업 탐험가", keywords: ["#프로젝트수업", "#예술적감각", "#질문의힘", "#창의융합"], praise: "선생님은 교실이라는 캔버스에 새로운 아이디어로 그림 그리기를 즐기는 예술가와 같습니다. 틀에 박힌 수업보다 아이들의 호기심을 자극하는 다양한 활동을 시도하며, 지식을 생생한 경험으로 만들어주는 특별한 재능이 있으시군요. 선생님의 교실은 아이들에게 세상은 넓고 배움은 즐겁다는 것을 알려주는 탐험의 공간입니다.", interpretation: "이러한 개방성은 프로젝트 기반 학습(PBL), 토론 수업, 창의적 체험 활동에서 엄청난 강점이 됩니다. 아이들이 정답 없는 질문에 도전하고, 자신만의 방식으로 문제를 해결하도록 격려해주세요. 선생님의 창의력이 아이들의 잠재력을 깨우는 열쇠가 될 것입니다." },
                low: { title: "안정적인 수업 설계자", keywords: ["#체계적수업", "#안정감", "#루틴의힘", "#신뢰"], praise: "선생님은 예측 가능하고 안정적인 수업 환경을 만들어 아이들에게 심리적 안정감을 주는 등대와 같은 분입니다. 검증된 교육 방법과 체계적인 커리큘럼을 통해 아이들이 흔들림 없이 학습 목표에 도달하도록 이끌어주시네요. 선생님의 일관성과 신뢰감은 아이들이 배움의 여정에서 길을 잃지 않도록 지켜주는 든든한 버팀목입니다.", interpretation: "이 강점은 기초 학력을 다지고, 명확한 규칙과 루틴을 통해 안정적인 학급 분위기를 만드는 데 탁월합니다. 예측 가능한 수업 구조는 특히 불안감이 높은 아이들에게 큰 도움이 됩니다. 선생님의 안정적인 리더십 안에서 아이들은 자신감을 갖고 차근차근 성장할 것입니다." }
            },
            C: {
                high: { title: "믿음직한 성장 네비게이터", keywords: ["#꼼꼼한피드백", "#책임감", "#공정함", "#계획의달인"], praise: "선생님은 아이들 한 명 한 명의 성장을 꼼꼼하게 계획하고, 목표를 향해 꾸준히 나아갈 수 있도록 돕는 믿음직한 네비게이터입니다. 철저한 수업 준비와 공정한 평가, 그리고 책임감 있는 모습은 아이들에게 '노력은 배신하지 않는다'는 귀한 가치를 몸소 보여줍니다. 선생님은 아이들에게 신뢰 그 자체입니다.", interpretation: "이 성실함은 개별화된 피드백, 체계적인 학습 관리, 장기적인 프로젝트 지도에서 빛을 발합니다. 학습 계획을 세우고, 꾸준히 실천하는 습관을 아이들에게 가르쳐주세요. 선생님의 성실한 모습을 보며 아이들은 자기 주도 학습의 중요성을 배우게 될 것입니다." },
                low: { title: "유연한 상황 대처 전문가", keywords: ["#자율성존중", "#즉흥수업", "#유연한사고", "#위기대처"], praise: "선생님은 정해진 계획보다 아이들의 흥미와 필요에 따라 수업의 방향을 유연하게 바꾸는 순발력의 대가입니다. 예기치 못한 질문이나 돌발 상황도 당황하지 않고 즐거운 배움의 기회로 만들어버리는 마법 같은 능력이 있으시네요. 선생님의 교실은 살아 움직이는 생명체처럼 활기가 넘칩니다.", interpretation: "이 유연성은 토론이 예상치 못한 방향으로 흘러갈 때, 아이들의 '딴짓'에서 새로운 배움의 실마리를 찾아낼 때 큰 힘이 됩니다. 아이들에게 더 많은 자율성을 부여하고, 그들의 선택을 믿고 지지해주세요. 때로는 계획 없는 즉흥적인 활동이 아이들에게 가장 기억에 남는 수업이 될 수 있습니다." }
            },
            E: {
                high: { title: "에너자이저, 긍정 에너지 전파자", keywords: ["#활기찬수업", "#발표와토론", "#소통의왕", "#긍정파워"], praise: "선생님은 교실에 들어서는 것만으로도 분위기를 밝게 만드는 인간 비타민 같은 존재입니다. 선생님의 넘치는 에너지와 열정은 아이들에게 고스란히 전달되어, 소극적인 아이도 발표하게 만들고 지루한 내용도 흥미진진한 이야기로 바꾸어 놓습니다. 학부모님들과의 소통에서도 그 빛을 발휘하시겠네요.", interpretation: "이 강점을 활용해 역동적인 그룹 활동, 발표, 역할극 중심의 수업을 이끌어보세요. 선생님의 긍정적인 에너지는 아이들의 참여를 이끌어내는 가장 강력한 동기부여입니다. 선생님의 활기찬 교실에서 아이들은 배움의 즐거움을 온몸으로 느끼게 될 것입니다." },
                low: { title: "깊이 있는 관찰자, 일대일 멘토", keywords: ["#깊은경청", "#일대일소통", "#차분한교실", "#통찰력"], praise: "선생님은 시끄러운 무리 속에서도 조용히 빛나는 한 아이의 눈빛을 발견하는 깊이 있는 관찰자입니다. 한 번에 모든 아이에게 에너지를 쏟기보다, 한 명 한 명과의 깊이 있는 대화를 통해 아이의 내면을 들여다보고 맞춤형 지지를 해주는 진정한 멘토시군요. 선생님의 차분함은 아이들에게 큰 위로와 안정감을 줍니다.", interpretation: "상담 활동, 개별 과제에 대한 심층 피드백, 소그룹 활동에서 선생님의 강점은 극대화됩니다. 아이들이 자신의 생각과 감정을 차분히 글로 표현하거나, 일대일로 이야기할 기회를 많이 만들어주세요. 선생님의 깊이 있는 경청이 아이의 잠재력을 여는 문이 될 것입니다." }
            },
            A: {
                high: { title: "따뜻한 우리 반 상담사", keywords: ["#공감능력", "#협동학습", "#배려", "#안전기지"], praise: "선생님의 교실은 아이들이 어떤 실수나 어려움을 겪어도 괜찮다고 말해주는 따뜻하고 안전한 '안전 기지'입니다. 아이들의 마음을 먼저 읽어주고 공감해주는 선생님의 따뜻함은 교실을 단순한 배움의 공간이 아닌, 서로를 보듬어주는 공동체로 만듭니다. 선생님은 아이들에게 '우리 편'이라는 절대적인 믿음을 주시는 분입니다.", interpretation: "또래 중재, 협동 학습 프로젝트, 인성 교육에서 선생님의 따뜻함은 그 어떤 교육 자료보다 강력한 힘을 발휘합니다. 아이들이 서로 돕고 배려하는 문화를 만들 수 있도록 격려해주세요. 선생님의 교실에서 아이들은 지식뿐만 아니라 더불어 살아가는 지혜를 배우게 될 것입니다." },
                low: { title: "원칙을 지키는 공정한 심판관", keywords: ["#객관적평가", "#논리적사고", "#원칙", "#성장의자극"], praise: "선생님은 아이들의 감정에 휩쓸리기보다, 정해진 원칙과 기준에 따라 객관적으로 판단하는 공정한 심판관입니다. 때로는 아이들에게 쓴소리도 할 수 있는 선생님의 단호함은, 아이들이 현실의 벽을 넘고 한 단계 더 성장하도록 돕는 건강한 자극이 됩니다. 선생님은 아이들이 더 큰 세상으로 나아갈 수 있도록 훈련시키는 전략가입니다.", interpretation: "논리적 사고력을 키우는 토론 수업, 명확한 기준에 따른 수행평가, 갈등 상황에서의 객관적인 중재에서 선생님의 강점이 드러납니다. '왜?'라는 질문을 통해 아이들이 자신의 주장에 대한 논리적 근거를 찾도록 이끌어주세요. 선생님의 객관성은 아이들이 감정이 아닌 이성으로 문제를 해결하는 법을 배우게 할 것입니다." }
            },
            N: {
                high: { title: "섬세한 마음 스캐너", keywords: ["#세심한관찰", "#공감적지지", "#위기감지", "#안전제일"], praise: "선생님은 아이들의 작은 표정 변화나 행동에서도 그 아이의 마음 상태를 읽어내는 섬세한 레이더를 가지고 계십니다. 혹시나 모를 위험이나 아이들 사이의 갈등을 미리 감지하고 대처하는 능력은 선생님의 뛰어난 감수성 덕분입니다. 선생님의 세심함은 아이들을 보이지 않는 위험으로부터 지켜주는 든든한 울타리입니다.", interpretation: "이 섬세함은 학기 초 학생들의 적응을 돕거나, 학교 폭력 예방, 불안감이 높은 학생을 상담할 때 특히 중요합니다. 선생님의 예민함을 '나를 힘들게 하는 것'이 아닌 '아이들을 지키는 힘'으로 바라봐 주세요. 선생님의 걱정은 아이들을 향한 깊은 사랑의 또 다른 표현입니다." },
                low: { title: "폭풍 속의 평온한 등대", keywords: ["#침착함", "#위기대처능력", "#정서적안정감", "#스트레스관리"], praise: "아이들이 싸우고, 교실이 아수라장이 되는 위기의 순간에도 선생님은 쉽게 평정심을 잃지 않는 강인한 등대와 같습니다. 선생님의 침착하고 안정적인 태도는 혼란스러운 상황을 빠르게 정리하고, 아이들에게 '괜찮다'는 무언의 메시지를 전달합니다. 선생님의 굳건함은 교실의 폭풍을 잠재우는 힘입니다.", interpretation: "예기치 못한 사건사고 대응, 갈등 중재, 압박감이 높은 공개수업이나 행사 진행 시 선생님의 정서적 안정감은 모두에게 큰 힘이 됩니다. 스트레스 관리 비법을 아이들과 함께 나누어 보세요. 선생님의 침착함을 보며 아이들은 어려운 상황에 대처하는 회복탄력성을 배우게 될 것입니다." }
            }
        };

        const studentInterpretations = {
            O: {
                high: { title: "호기심 많은 아이디어 뱅크", keywords: ["#창의적사고", "#새로운도전", "#탐구학습", "#독창성"], praise: "당신은 교과서 너머의 세상을 궁금해하는 '호기심 많은 탐험가'군요! 남들이 당연하게 여기는 것에도 '왜?'라는 질문을 던질 줄 알고, 자신만의 독특한 방식으로 문제를 해결하는 것을 즐깁니다. 당신의 상상력은 평범한 하루를 특별한 모험으로 만드는 멋진 능력이에요.", interpretation: "이런 강점은 국어, 사회, 과학 등 다양한 과목에서 창의적인 보고서를 쓰거나, 새로운 아이디어를 내는 프로젝트 학습에서 특히 빛을 발할 거예요. 틀에 박힌 공부법보다는 마인드맵을 그리거나, 친구들과 토론하며 자신만의 방식으로 지식을 재구성해보세요. 당신의 호기심이 최고의 스승이 될 것입니다." },
                low: { title: "성실한 실용주의 학습자", keywords: ["#꾸준함", "#현실적", "#집중력", "#루틴"], praise: "당신은 뜬구름 잡는 이야기보다, 명확한 공식과 규칙을 바탕으로 차근차근 실력을 쌓아가는 '성실한 건축가'와 같아요. 정해진 학습 계획을 꾸준히 실천하며, 안정적으로 자신의 목표를 달성하는 모습이 정말 믿음직스럽네요. 당신의 꾸준함이 가장 큰 무기입니다.", interpretation: "수학이나 과학처럼 정답이 명확한 과목에서 강점을 보일 수 있어요. '개념 이해 -> 문제 풀이 -> 오답 노트'와 같은 검증된 학습 루틴을 만들고 꾸준히 실천하면, 누구보다 탄탄한 실력을 갖추게 될 거예요. 안정적인 학습 환경 속에서 최고의 효율을 발휘할 수 있습니다." }
            },
            C: {
                high: { title: "믿음직한 계획 실천가", keywords: ["#계획왕", "#성실함", "#책임감", "#꼼꼼함"], praise: "당신은 시험 기간에 '플래너'를 가장 잘 활용하는 친구일 거예요. 목표를 세우면, 그것을 이루기 위해 체계적으로 계획하고 꾸준히 실천하는 '믿음직한 항해사'와 같군요. 당신의 성실함과 책임감은 친구들과 선생님 모두에게 큰 신뢰를 줍니다.", interpretation: "수행평가나 장기 프로젝트에서 당신의 능력은 100% 발휘될 거예요. 과제를 미리미리 준비하고, 꼼꼼하게 결과물을 챙기는 당신의 모습은 좋은 성적으로 이어질 가능성이 높습니다. 다만, 가끔은 너무 완벽하려다 스트레스를 받을 수 있으니, '이만하면 됐어!'라고 말해주는 여유도 필요해요." },
                low: { title: "자유로운 즉흥 탐험가", keywords: ["#순발력", "#유연함", "#벼락치기초능력", "#자유로운영혼"], praise: "당신은 빡빡한 계획표보다, 그날의 기분과 흥미에 따라 자유롭게 공부하는 '즉흥적인 예술가' 타입이군요. 시험 전날, 놀라운 집중력으로 '벼락치기' 초능력을 발휘하기도 하죠! 갑작스러운 조별 과제나 예상치 못한 문제 상황에서 당신의 순발력은 더욱 빛납니다.", interpretation: "변화가 많고 순발력이 필요한 토론 수업이나 실시간 문제 해결 활동에서 즐거움을 느낄 수 있어요. 당신의 유연함은 창의적인 아이디어로 이어지기도 합니다. 다만, 중요한 시험이나 과제는 미리 조금씩이라도 준비하는 습관을 들인다면, 당신의 '초능력'을 더욱 안정적으로 발휘할 수 있을 거예요." }
            },
            E: {
                high: { title: "인싸력 만렙, 분위기 메이커", keywords: ["#리더십", "#사교성", "#발표왕", "#긍정에너지"], praise: "당신은 반의 활기를 책임지는 '인간 비타민'이군요! 친구들과 어울리며 에너지를 얻고, 조별 활동에서는 자연스럽게 분위기를 이끌어가는 리더의 모습을 보여줍니다. 당신의 밝은 에너지와 자신감 있는 발표는 모두의 주목을 받기에 충분해요.", interpretation: "모둠 활동, 토론, 발표 수업은 당신을 위한 무대입니다. 친구들의 의견을 조율하고, 자신감 있게 발표하며 리더십을 발휘해보세요. 다양한 친구들과 교류하며 인맥을 넓히는 것도 당신에겐 큰 자산이 될 거예요. 혼자 공부할 때 지루하다면, 친구들과 스터디 그룹을 만들어보는 것도 좋은 방법입니다." },
                low: { title: "깊이 생각하는 독립적 사색가", keywords: ["#집중력", "#통찰력", "#소수정예", "#깊이있는탐구"], praise: "당신은 시끌벅적한 무리보다, 조용한 도서관 창가에서 깊은 생각에 잠기는 것을 즐기는 '독립적인 사색가'입니다. 혼자만의 시간을 통해 에너지를 충전하고, 관심 있는 분야를 깊이 파고드는 것을 좋아하죠. 당신의 깊이 있는 통찰력은 친구들에게 새로운 관점을 제시해주곤 합니다.", interpretation: "복잡한 수학 문제를 풀거나, 긴 글을 읽고 분석하는 등 깊은 집중력이 필요한 학습에서 뛰어난 능력을 발휘할 수 있어요. 당신에게는 넓고 얕은 관계보다, 마음이 잘 맞는 소수의 친구들과의 깊은 우정이 더 중요할 거예요. 혼자서 탐구하는 시간을 충분히 확보하는 것이 당신의 잠재력을 키우는 비결입니다." }
            },
            A: {
                high: { title: "모두의 친구, 평화주의자", keywords: ["#배려심", "#팀워크", "#공감요정", "#다정함"], praise: "당신은 친구들 사이의 다툼을 중재하고, 어려움에 처한 친구를 가장 먼저 도와주는 '우리 반의 상담사' 같은 존재군요. 다른 사람의 감정을 잘 이해하고 공감해주며, 모두가 사이좋게 지내는 것을 중요하게 생각합니다. 당신의 따뜻한 마음씨는 주변을 환하게 만들어요.", interpretation: "협동이 중요한 조별 과제에서 당신의 강점은 빛을 발합니다. 팀원들을 챙기고, 갈등을 조율하며 최고의 팀워크를 만들어낼 수 있어요. 친구들의 고민을 잘 들어주는 당신은 이미 훌륭한 리더의 자질을 갖추고 있습니다. 다만, 가끔은 거절하는 용기도 필요하다는 것을 잊지 마세요." },
                low: { title: "솔직한 비평가, 논리의 승부사", keywords: ["#솔직함", "#논리적", "#자기주장", "#객관적"], praise: "당신은 '좋은 게 좋은 거지'라며 넘어가기보다, 자신의 생각과 논리에 따라 솔직하게 의견을 말하는 '정의로운 비평가'입니다. 친구의 의견이라도 논리적으로 맞지 않으면, 용기 있게 질문을 던질 줄 알죠. 당신의 객관적인 시선은 그룹이 더 나은 결정을 내리도록 돕습니다.", interpretation: "토론이나 비판적 글쓰기에서 당신의 논리력은 강력한 무기가 될 거예요. 감정에 휩쓸리지 않고 문제의 핵심을 꿰뚫어 보는 능력이 있습니다. 때로는 너무 직설적이어서 친구들이 오해할 수도 있지만, 당신의 진심은 '더 나은 결과'를 위한 것임을 기억하세요. 당신의 소신 있는 태도가 세상을 바꾸는 힘이 될 수 있습니다." }
            },
            N: {
                high: { title: "섬세한 감성의 소유자, 신중한 전략가", keywords: ["#신중함", "#감수성", "#완벽주의", "#실수제로도전"], praise: "당신은 시험을 볼 때 실수는 없는지 몇 번이고 확인하고, 수행평가 하나에도 많은 신경을 쓰는 '신중한 전략가'입니다. 풍부한 감수성 덕분에 친구의 작은 감정 변화도 잘 알아채고, 예술 작품에 깊이 감동하기도 하죠. 당신의 세심함은 실수를 줄이는 최고의 무기입니다.", interpretation: "꼼꼼함이 요구되는 서술형 평가나 실험 보고서 작성에서 강점을 보일 수 있어요. 시험에 대한 불안감은 '더 철저히 준비해야지!'라는 긍정적인 동기로 바꿀 수 있다면, '건강한 긴장감'으로 작용해 좋은 결과를 낼 수 있습니다. 가끔은 '이 정도면 괜찮아'라며 스스로를 다독여주는 연습도 필요해요." },
                low: { title: "강철 멘탈, 긍정의 아이콘", keywords: ["#대담함", "#침착함", "#회복탄력성", "#스트레스프리"], praise: "당신은 큰 시험이나 발표를 앞두고도 태연하게 잠을 잘 자는 '강철 멘탈'의 소유자군요! 친구들이 모두 긴장할 때도, 혼자 침착함을 유지하며 긍정적인 기운을 뿜어냅니다. 넘어져도 금방 툭툭 털고 일어나는 당신의 모습은 정말 멋져요.", interpretation: "중요한 시험이나 경시대회처럼 압박감이 큰 상황에서 당신의 침착함은 최고의 실력을 발휘하게 할 거예요. 스트레스 관리 능력이 뛰어나기 때문에, 어려운 문제에 부딪혀도 쉽게 포기하지 않죠. 당신의 긍정적인 태도는 주변 친구들에게도 좋은 영향을 줄 수 있습니다. 당신의 든든함이 팀의 중심을 잡아줄 거예요." }
            }
        };

        // --- SCRIPT: Application Logic ---
        document.addEventListener('DOMContentLoaded', () => {
            // Elements
            const roleSelector = document.querySelectorAll('input[name="role"]');
            const slidersContainer = document.getElementById('trait-sliders');
            const analyzeBtn = document.getElementById('analyze-btn');
            const resultSection = document.getElementById('result-section');
            const resultTitle = document.getElementById('result-title');
            const keywordSection = document.getElementById('keyword-section');
            const interpretationSection = document.getElementById('interpretation-section');
            const chartCanvas = document.getElementById('result-chart');
            const aiSection = document.getElementById('ai-section');
            const aiBtn = document.getElementById('ai-btn');
            const aiResultCard = document.getElementById('ai-result-card');
            const aiLoading = document.getElementById('ai-loading');
            const aiLoadingText = document.getElementById('ai-loading-text');
            const aiContent = document.getElementById('ai-content');
            const aiTitle = document.getElementById('ai-title');
            const aiTip = document.getElementById('ai-tip');
            const apiKeyInput = document.getElementById('apiKeyInput');
            const apiKeyError = document.getElementById('api-key-error');
            const saveKeyBtn = document.getElementById('save-key-btn');

            let chartInstance = null;
            let currentScores = {};

            // Load saved API key
            apiKeyInput.value = localStorage.getItem('geminiApiKey') || '';

            // 1. Create sliders
            Object.keys(traits).forEach(key => {
                slidersContainer.innerHTML += `
                    <div class="trait-slider">
                        <div class="flex justify-between items-center mb-1">
                            <label for="${key}" class="font-bold text-lg">${traits[key].name}</label>
                            <span id="${key}-value" class="text-indigo-600 font-bold text-lg bg-indigo-100 px-3 py-1 rounded-full">50</span>
                        </div>
                        <input type="range" id="${key}" name="${key}" min="0" max="100" value="50" class="w-full h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                `;
            });

            // 2. Add event listeners
            Object.keys(traits).forEach(key => {
                document.getElementById(key).addEventListener('input', (e) => {
                    document.getElementById(`${key}-value`).textContent = e.target.value;
                });
            });

            analyzeBtn.addEventListener('click', () => {
                const scores = {};
                const labels = [];
                const data = [];
                Object.keys(traits).forEach(key => {
                    scores[key] = parseInt(document.getElementById(key).value);
                    labels.push(traits[key].name);
                    data.push(scores[key]);
                });
                currentScores = scores;
                displayResults(scores, labels, data);
            });
            
            aiBtn.addEventListener('click', () => getAITip(currentScores));
            
            saveKeyBtn.addEventListener('click', () => {
                const key = apiKeyInput.value.trim();
                if (key) {
                    localStorage.setItem('geminiApiKey', key);
                    apiKeyError.textContent = 'API 키가 저장되었습니다.';
                    apiKeyError.classList.remove('text-red-500');
                    apiKeyError.classList.add('text-green-600');
                    setTimeout(() => apiKeyError.textContent = '', 2000);
                } else {
                    localStorage.removeItem('geminiApiKey');
                    apiKeyError.textContent = '키가 비어있어 저장되지 않았습니다.';
                    apiKeyError.classList.add('text-red-500');
                    apiKeyError.classList.remove('text-green-600');
                }
            });

            // 3. Display results function
            function displayResults(scores, labels, data) {
                const selectedRole = document.querySelector('input[name="role"]:checked').value;
                const interpretations = selectedRole === 'teacher' ? teacherInterpretations : studentInterpretations;

                resultSection.classList.remove('hidden');
                aiSection.classList.remove('hidden');
                aiResultCard.classList.add('hidden');
                aiContent.classList.add('hidden');
                keywordSection.innerHTML = '';
                interpretationSection.innerHTML = '';

                const aiIcon = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2"><path d="M12 8V4H8"></path><rect x="4" y="12" width="16" height="8" rx="2"></rect><path d="M4 14H2"></path><path d="M20 14H22"></path><path d="M15 12V8H9v4"></path></svg>`;

                if (selectedRole === 'teacher') {
                    resultTitle.textContent = "선생님의 강점 프로필";
                    aiBtn.innerHTML = `${aiIcon} AI에게 맞춤형 교실 꿀팁 물어보기`;
                    aiLoadingText.textContent = "AI 교육 컨설턴트가 선생님만을 위한 팁을 만들고 있어요...";
                    aiTitle.innerHTML = `${aiIcon} AI의 맞춤형 교실 코칭`;
                } else {
                    resultTitle.textContent = "나의 강점 프로필";
                    aiBtn.innerHTML = `${aiIcon} AI에게 맞춤형 성장 꿀팁 물어보기`;
                    aiLoadingText.textContent = "AI 학습 멘토가 당신만을 위한 팁을 만들고 있어요...";
                    aiTitle.innerHTML = `${aiIcon} AI의 맞춤형 성장 코칭`;
                }

                const prominentTraits = [];
                Object.keys(scores).forEach(key => {
                    if (scores[key] >= 67) prominentTraits.push({ key, type: 'high' });
                    else if (scores[key] <= 33) prominentTraits.push({ key, type: 'low' });
                });
                
                if (prominentTraits.length === 0) {
                    let highestKey = 'O', lowestKey = 'O';
                    let maxScore = -1, minScore = 101;
                    Object.keys(scores).forEach(key => {
                        if (scores[key] > maxScore) { maxScore = scores[key]; highestKey = key; }
                        if (scores[key] < minScore) { minScore = scores[key]; lowestKey = key; }
                    });
                    prominentTraits.push({ key: highestKey, type: 'high' });
                    if (highestKey !== lowestKey) prominentTraits.push({ key: lowestKey, type: 'low' });
                }

                prominentTraits.forEach((traitInfo, index) => {
                    const interpretation = interpretations[traitInfo.key][traitInfo.type];
                    interpretation.keywords.forEach(kw => {
                        keywordSection.innerHTML += `<span class="bg-indigo-100 text-indigo-800 font-semibold px-3 py-1 rounded-full text-sm">${kw}</span>`;
                    });
                    const card = document.createElement('div');
                    card.className = "result-card bg-white p-6 rounded-xl shadow-md border border-gray-200/80";
                    card.innerHTML = `
                        <h3 class="text-xl font-bold mb-3 text-gray-800">${interpretation.title}</h3>
                        <p class="text-indigo-700 mb-4 p-4 bg-indigo-50 rounded-lg border-l-4 border-indigo-300">${interpretation.praise}</p>
                        <p class="text-gray-600">${interpretation.interpretation}</p>
                    `;
                    interpretationSection.appendChild(card);
                    setTimeout(() => card.classList.add('visible'), 100 * (index + 1));
                });
                
                resultSection.scrollIntoView({ behavior: 'smooth' });

                if (chartInstance) chartInstance.destroy();
                chartInstance = new Chart(chartCanvas, {
                    type: 'radar',
                    data: {
                        labels: labels.map(l => l.split(' ')[0]),
                        datasets: [{
                            label: '나의 점수', data,
                            backgroundColor: 'rgba(79, 70, 229, 0.25)',
                            borderColor: 'rgba(79, 70, 229, 1)',
                            borderWidth: 2, pointBackgroundColor: '#fff',
                            pointBorderColor: 'rgba(79, 70, 229, 1)',
                            pointRadius: 5,
                            pointHoverRadius: 7
                        }]
                    },
                    options: { 
                        scales: { 
                            r: { 
                                beginAtZero: true, 
                                max: 100,
                                pointLabels: {
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    },
                                    color: '#374151'
                                },
                                grid: {
                                    color: 'rgba(0, 0, 0, 0.08)'
                                },
                                angleLines: {
                                    color: 'rgba(0, 0, 0, 0.08)'
                                },
                                ticks: {
                                    backdropColor: 'transparent',
                                    stepSize: 25
                                }
                            } 
                        }, 
                        plugins: { 
                            legend: { display: false } 
                        } 
                    }
                });
            }
            
            // 4. AI Tip Generation Function
            async function getAITip(scores) {
                const userApiKey = (localStorage.getItem('geminiApiKey') || '').trim();
                
                if (!userApiKey) {
                    apiKeyError.textContent = 'AI 기능을 사용하려면 API 키를 입력하고 저장해주세요.';
                    apiKeyError.classList.add('text-red-500');
                    apiKeyError.classList.remove('text-green-600');
                    apiKeyInput.focus();
                    return;
                }
                apiKeyError.textContent = '';

                aiResultCard.classList.remove('hidden');
                aiResultCard.classList.add('visible');
                aiLoading.style.display = 'flex';
                aiContent.classList.add('hidden');
                aiResultCard.scrollIntoView({ behavior: 'smooth', block: 'center' });

                const selectedRole = document.querySelector('input[name="role"]:checked').value;
                
                let prompt;
                if (selectedRole === 'teacher') {
                    prompt = `You are an expert educational consultant with a warm and empathetic tone. A teacher from Korea has the following Big Five personality scores: 
                    - Openness: ${scores.O}, Conscientiousness: ${scores.C}, Extraversion: ${scores.E}, Agreeableness: ${scores.A}, Neuroticism: ${scores.N}
                    Based on this unique profile, provide one creative, practical, and highly personalized classroom tip. The tip should help the teacher leverage their specific strengths and feel empowered. The response must be in Korean. Frame it as a warm, personal coaching message directly to the teacher. Start with a short, encouraging sentence recognizing their strengths, and then present the tip.`;
                } else { // student
                    prompt = `You are an expert student mentor with a warm and encouraging tone. A student from Korea has the following Big Five personality scores: 
                    - Openness: ${scores.O}, Conscientiousness: ${scores.C}, Extraversion: ${scores.E}, Agreeableness: ${scores.A}, Neuroticism: ${scores.N}
                    Based on this unique profile, provide one creative, practical, and highly personalized tip for their school life (e.g., study methods, making friends, future career paths). The tip should help the student leverage their specific strengths and feel confident. The response must be in Korean. Frame it as a warm, personal coaching message directly to the student. Start with a short, encouraging sentence recognizing their strengths, and then present the tip.`;
                }

                try {
                    const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${userApiKey}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    const result = await response.json();

                    let tipText;
                    if (response.ok && result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        tipText = result.candidates[0].content.parts[0].text;
                    } else {
                        tipText = `오류가 발생했습니다. (HTTP ${response.status})\nAPI 키가 유효한지, 또는 사용량이 초과되지 않았는지 확인해주세요.`;
                        console.error("API Error:", result);
                    }
                    aiTip.textContent = tipText;

                } catch (error) {
                    console.error("Error fetching AI tip:", error);
                    aiTip.textContent = "AI 팁을 불러오는 중 네트워크 오류가 발생했습니다. 인터넷 연결을 확인하고 다시 시도해주세요.";
                } finally {
                    aiLoading.style.display = 'none';
                    aiContent.classList.remove('hidden');
                }
            }
        });
    </script>
</body>
</html>
